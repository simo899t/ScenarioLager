{% extends "base.html" %}

{% block title %}{{ product.name }} - Info{% endblock %}

{% block content %}
<h1>{{ product.name }}</h1>

<div class="info-card">
    <div class="info-grid">
        <div class="info-item">
            <strong>ID:</strong>
            <span>{{ product.sku }}</span>
        </div>
        <div class="info-item">
            <strong>Location:</strong>
            <span>{{ product.location or '-' }}</span>
        </div>
        <div class="info-item">
            <strong>Status:</strong>
            <span>
                {% if product.is_available %}
                <span class="badge badge-success">Available</span>
                {% else %}
                <span class="badge badge-warning">In Use</span>
                {% endif %}
            </span>
        </div>
    </div>
    
    {% if product.description %}
    <div class="info-description">
        <strong>Description:</strong>
        <p>{{ product.description }}</p>
    </div>
    {% endif %}
</div>

{% if active_checkout %}
<div class="section active-checkout">
    <h2>Currently Checked Out</h2>
    <div class="checkout-details">
        <p><strong>Borrower:</strong> {{ active_checkout.borrower_name }}</p>
        <p><strong>From:</strong> {{ active_checkout.from_date.strftime('%d/%m/%Y %H:%M') }}</p>
        <p><strong>To:</strong> {{ active_checkout.to_date.strftime('%d/%m/%Y %H:%M') }}</p>
        {% if active_checkout.notes %}
        <p><strong>Notes:</strong> {{ active_checkout.notes }}</p>
        {% endif %}
        <p><strong>Checked out by:</strong> {{ active_checkout.user.username }} on {{ active_checkout.checked_out_at.strftime('%d/%m/%Y %H:%M') }}</p>
    </div>
    <form method="POST" action="{{ url_for('main.return_product', id=product.id) }}">
        <button type="submit" class="btn btn-success">Mark as Returned</button>
    </form>
</div>
{% endif %}

<div class="section">
    <h2>Checkout History</h2>
    {% if checkout_history %}
    <table class="table">
        <thead>
            <tr>
                <th>Borrower</th>
                <th>From</th>
                <th>To</th>
                <th>Status</th>
                <th>Checked Out</th>
                <th>Returned</th>
            </tr>
        </thead>
        <tbody>
            {% for checkout in checkout_history %}
            <tr>
                <td>{{ checkout.borrower_name }}</td>
                <td>{{ checkout.from_date.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ checkout.to_date.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>
                    <span class="badge badge-{{ 'success' if checkout.status == 'returned' else 'warning' }}">
                        {{ checkout.status.title() }}
                    </span>
                </td>
                <td>{{ checkout.checked_out_at.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ checkout.returned_at.strftime('%d/%m/%Y %H:%M') if checkout.returned_at else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No checkout history</p>
    {% endif %}
</div>

<div class="form-actions">
    <a href="{{ url_for('main.inventory') }}" class="btn">Back to Storage</a>
    {% if product.is_available %}
    <a href="{{ url_for('main.use_product', id=product.id) }}" class="btn btn-primary">Check Out</a>
    {% endif %}
</div>
{% endblock %}
